<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard page</title>
    <link rel="stylesheet" type="text/css" href="/userManagement/admin/css/style.css">

</head>
<body>
    <!-- =================  Navigation  ===========  -->
    <div class="container">
        <div class="navigation">
            <ul>
                <li>
                    <a href="#">
                        <span class="icon">
                            <div class="user">
                                <img src="/userManagement/admin/imgs/customer.avif" alt="">
                            </div>
                        </span>
                        <span class="title1">Admin</span>
                    </a>
                </li>
                <li>
                    <a href="#">
                        <span class="icon">
                            <ion-icon name="home-outline"></ion-icon>
                        </span>
                        <span class="title">Dashboard</span>
                    </a>
                </li>
                <li>
                    <a href="#" onclick="scrollToRecentCustomers()">
                        <span class="icon">
                            <ion-icon name="people-outline"></ion-icon>
                        </span>
                        <span class="title">Customers</span>
                    </a>
                </li>
                <li>
                    <a href="#">
                        <span class="icon">
                            <ion-icon name="chatbubble-outline"></ion-icon>
                        </span>
                        <span class="title">Messages</span>
                    </a>
                </li>
                <li>
                    <a href="#">
                        <span class="icon">
                            <ion-icon name="help-circle-outline"></ion-icon>
                        </span>
                        <span class="title">Help</span>
                    </a>
                </li>
                <li>
                    <a href="#">
                        <span class="icon">
                            <ion-icon name="settings-outline"></ion-icon>
                        </span>
                        <span class="title">Settings</span>
                    </a>
                </li>
                <li>
                    <a href="#">
                        <span class="icon">
                            <ion-icon name="lock-closed-outline"></ion-icon>
                        </span>
                        <span class="title">Password</span>
                    </a>
                </li>
                <li>
                    <a href="/admin/logout">
                        <span class="icon">
                            <ion-icon name="log-out-outline"></ion-icon>
                        </span>
                        <span class="title">Sign out</a></span>
                    </a>
                </li>
            </ul>
        </div>
    </div>

    <!-- ============  Main  ==========  -->
    <div class="main">
        <div class="topbar">
            <div class="toggle">
                <ion-icon name="menu-outline";"></ion-icon>
            </div>

            <div class="search">
                <label>
                    <input type="text" placeholder="Seach here">
                    <ion-icon name="search-outline"></ion-icon>
                </label>
            </div>

            <div class="user">
                <img src="/userManagement/admin/imgs/customer.avif" alt="">
            </div>
        </div>

        <!--============== Cards ============= -->
        <div class="cardBox">
            <div class="card">
                <div>
                    <div class="numbers"><%= totalCustomers %></div>
                    <div class="cardName">Customers</div>
                </div>

                <div class="iconBx">
                    <ion-icon name="people-outline"></ion-icon>
                </div>
            </div>

            <div class="card">
                <div>
                    <div class="numbers"><%= totalBookings %></div>
                    <div class="cardName">Bookings</div>
                </div>

                <div class="iconBx">
                    <ion-icon name="cart-outline"></ion-icon>
                </div>
            </div>

            <div class="card">
                <div>
                    <div class="numbers"></div>
                    <div class="cardName">Comments</div>
                </div>

                <div class="iconBx">
                    <ion-icon name="chatbubble-outline"></ion-icon>
                </div>
            </div>

            <div class="card">
                <div>
                    <div class="numbers">ksh <%= totalEarnings.toLocaleString() %></div>
                    <div class="cardName">Earnings</div>
                </div>

                <div class="iconBx">
                    <ion-icon name="cash-outline"></ion-icon>
                </div>
            </div>

            <div class="card">
                <div>
                    <div class="numbers"><%= statusCounts.totalPending %></div>
                    <div class="cardName">Pending</div>
                </div>
            
                <div class="iconBx">
                    <ion-icon name="cart-outline"></ion-icon>
                </div>
            </div>
            
            <div class="card">
                <div>
                    <div class="numbers"><%= statusCounts.totalReturn %></div>
                    <div class="cardName">Return</div>
                </div>
            
                <div class="iconBx">
                    <ion-icon name="arrow-back-circle-outline"></ion-icon>
                </div>
            </div>
            
            <div class="card">
                <div>
                    <div class="numbers"><%= statusCounts.totalInProgress %></div>
                    <div class="cardName">In Progress</div>
                </div>
            
                <div class="iconBx">
                    <ion-icon name="arrow-forward-circle-outline"></ion-icon>
                </div>
            </div>
            
            <div class="card">
                <div>
                    <div class="numbers"><%= statusCounts.totalDelivered %></div>
                    <div class="cardName">Delivered</div>
                </div>
            
                <div class="iconBx">
                    <ion-icon name="cart-outline"></ion-icon>
                </div>
            </div>
            
        </div>


        <!-- ==================== Order Details List ============= -->
        <div class="details">
            <div class="recentOrders">
                <div class="cardHeader">
                    <h2>Recent Orders</h2>
                    <a href="#" class="btn">View All</a>
                </div>

                <table>
                    <thead>
                        <tr>
                            <td>Sender Email</td>
                            <td>Receiver Email</td>
                            <td>Pickup Address</td>
                            <td>Delivery Address</td>
                            <td>From</td>
                            <td>To</td>
                            <td>Quantity</td>
                            <td>Hazardous?</td>
                            <td>Code</td>
                            <td>Status</td>
                            <td>Action</td>
                        </tr>
                    </thead>

                    <tbody>
                        <tr>



                            <% cargoBooking.forEach(function(cargoBooking) { %>
                                <tr>
                                    <td><%= cargoBooking.sender_email %></td>
                                    <td><%= cargoBooking.receiver_email %></td>
                                    <td><%= cargoBooking.pickup_address %></td>
                                    <td><%= cargoBooking.delivery_address %></td>
                                    <td><%= cargoBooking.from_county %></td>
                                    <td><%= cargoBooking.to_county %></td>
                                    <td><%= cargoBooking.quantity %></td>
                                    <td><%= cargoBooking.hazardous_material %></td>
                                    <td><%= cargoBooking.code %></td>


                                    <% const statusLowerCase = cargoBooking.status.toLowerCase(); %>

                                    <% if (statusLowerCase === 'delivered') { %>
                                        <td style="padding: 2px; background: #8de02c; color: #fff; border-radius: 4px; font-size: 14px; font-weight: 500; height: 20px;">
                                            <%= cargoBooking.status %>
                                        </td>
                                    <% } else if (statusLowerCase === 'return') { %>
                                        <td style="padding: 2px; background: #f00; color: #fff; border-radius: 4px; font-size: 14px; font-weight: 500; height: 20px;">
                                            <%= cargoBooking.status %>
                                        </td>
                                    <% } else if (statusLowerCase === 'in progress') { %>
                                        <td style="padding: 2px; background: #1795ce; color: #fff; border-radius: 4px; font-size: 14px; font-weight: 500; height: 20px;">
                                            <%= cargoBooking.status %>
                                        </td>
                                    <% } else if (statusLowerCase === 'pending') { %>
                                        <td style="padding: 2px; background: #800080; color: #fff; border-radius: 4px; font-size: 14px; font-weight: 500; height: 20px;">
                                            <%= cargoBooking.status %>
                                        </td>
                                    <% } else { %>
                                        <td style="height: 20px;"><%= cargoBooking.status %></td>
                                    <% } %>
                                    
                                    
                                    
                                    
                                    
                                    

                                    
                                    <!--td><%= cargoBooking.status %></td-->
                                    <td>
                                        <div class="button">
                                            <form action="/editCargo" method="POST">
                                                <input type="hidden" name="code" value="<%= cargoBooking.code %>">
                                                <button type="button" class="btn" onclick="editStatus('<%= cargoBooking.status %>', '<%= cargoBooking.code %>')">Edit</button>
                                            </form>                                            
                                            <form action="/deleteCargo" method="POST">
                                                <input type="hidden" name="code" value="<%= cargoBooking.code %>">
                                                <button type="submit" class="btn">Delete</button>
                                            </form>
                                        </div>
                                    </td>
                                </tr>
                            <% }); %>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- =============== New Customers ============ -->
            <div id="recentCustomersSection" class="recentCustomers">
                <div class="cardHeader">
                    <h2>Recent Customers</h2>
                </div>

                <table>
                    <thead>
                        <tr>
                            <td>Image</td>
                            <td>Label</td>
                            <td>Full Name</td>
                            <td>Username</td>
                            <td>Email</td>
                            <td>Action</td>
                        </tr>
                    </thead>
                    <tbody>
                        <% customers.forEach(function(customer) { %>
                            <tr>
                                <td>
                                    <div class="user">
                                        <% if (customer.images) { %>
                                            <img src="data:image/png;base64, <%= Buffer.from(customer.images).toString('base64') %>" alt="User Image">
                                        <% } %>
                                    </div>                                
                                </td>
                                <td><%= customer.iam %></td>
                                <td><%= customer.fullname %></td>
                                <td><%= customer.username %></td>
                                <td><%= customer.email %></td>
                                <td>
                                    <div class="button">
                                        <!--form action="/editCargo" method="POST">
                                            <input type="hidden" name="code" value="<%= cargoBooking.code %>">
                                            <button type="button" class="btn" onclick="editStatus('<%= cargoBooking.status %>', '<%= cargoBooking.code %>')">Edit</button>
                                        </form-->
                                        <form action="/delete-customer" method="POST">
                                            <input type="hidden" name="email" value="<%= customer.email %>">
                                            <button type="submit" class="btn">Delete</button>
                                        </form>
                                    </div>
                                </td>
                            </tr>
                        <% }); %>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="charts">
            <div class="chart">
                <h2>Earnings (Past 12 months)</h2>
                <canvas id="lineChart"></canvas>
            </div>
            <div class="chart" id="doughnut-chart">
                <h2>Customers</h2>
                <canvas id="doughnut"></canvas>
            </div>
        </div>
    </div>
    <script>
        function scrollToRecentCustomers() {
            // Get the target element by its id
            var targetElement = document.getElementById("recentCustomersSection");
    
            // Use the scrollIntoView method to scroll to the target element
            targetElement.scrollIntoView({ behavior: "smooth", block: "start" });
        }


        function editStatus(initialStatus, cargoCode) {
            const newStatus = prompt("Enter new status", initialStatus);
            if (newStatus !== null) {
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = '/editCargo';
    
                const input = document.createElement('input');
                input.type = 'hidden';
                input.name = 'code';
                input.value = cargoCode;
                form.appendChild(input);
    
                const statusInput = document.createElement('input');
                statusInput.type = 'hidden';
                statusInput.name = 'status';
                statusInput.value = newStatus;
                form.appendChild(statusInput);
    
                document.body.appendChild(form);
                form.submit();
            }
        }
    </script>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="/userManagement/admin/js/main.js"></script>
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
    <script src="/userManagement/admin/js/main.js"></script>

</body>
</html>